# quiet
=begin
  Documentation: https://elanthipedia.play.net/Lich_script_repository#smartlisten
=end

custom_require.call(%w[common drinfomon])

no_pause_all
no_kill_all

listen_skills = get_settings.listen_skills

listen_skills += ['Life Magic', 'Elemental Magic', 'Lunar Magic', 'Holy Magic'] unless DRStats.barbarian? || DRStats.thief?

if DRStats.barbarian?
  listen_skills += ['Expertise', 'Inner Fire']
  listen_skills -= ['Arcana']
elsif DRStats.bard?
  listen_skills += ['Bardic Lore']
elsif DRStats.cleric?
  listen_skills += ['Theurgy']
elsif DRStats.empath?
  listen_skills += ['Empathy']
elsif DRStats.moon_mage?
  listen_skills += ['Astrology']
elsif DRStats.necromancer?
  listen_skills += ['Thanatology', 'Arcane Magic']
elsif DRStats.paladin?
  listen_skills += ['Endurance']
elsif DRStats.ranger?
  listen_skills += ['Scouting']
elsif DRStats.thief?
  listen_skills += ['Backstab', 'Inner Magic']
elsif DRStats.trader?
  listen_skills += ['Trading']
elsif DRStats.warrior_mage?
  listen_skills += ['Summoning', 'Elemental Magic']
end

loop do
  next unless script.gets =~ /(.*) begins to lecture you on the proper usage of the (.*) skill/
  teacher = Regexp.last_match(1)
  skill = Regexp.last_match(2)
  echo "Checking if I should listen to a class on #{skill}"

  next unless listen_skills.include?(skill)
  echo "Attempting to listen to #{teacher}"
  Script.running.find_all { |s| !s.paused? && !s.no_pause_all }.each(&:pause)
  DRC.listen?(teacher, get_settings.listen_observe)
  Script.running.find_all { |s| s.paused? && !s.no_pause_all }.each(&:unpause)
end
